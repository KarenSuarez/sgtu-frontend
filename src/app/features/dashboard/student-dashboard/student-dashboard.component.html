<div class="app-container" id="app-container">
  <nav class="navbar" id="navbar">
    <div class="navbar-left" id="navbar-left">
      <img
        src="assets/icons/logoUPTC.svg"
        alt="UPTC Logo"
        class="logo-image"
        id="logo-image"
      />
    </div>
    <div class="navbar-right" id="navbar-right">
      <div class="user-menu" id="user-menu">
        <div class="user-info" (click)="toggleUserMenu()" id="user-info">
          <img
            src="assets/images/usuario.png"
            alt="User Icon"
            class="user-icon"
            id="user-icon"
          />
          <span id="user-name">{{ userName.split(" ")[0] }}</span>
        </div>
        <div *ngIf="isUserMenuOpen" class="dropdown-menu" id="dropdown-menu">
          <button class="btn-secondary" (click)="logout()" id="logout-button">
            <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
          </button>
        </div>
      </div>
    </div>
  </nav>

  <div class="main-container" id="main-container">
    <div
      class="sidebar"
      [ngClass]="{ collapsed: isSidebarCollapsed }"
      id="sidebar"
    >
      <div class="sidebar-header" id="sidebar-header">
        <div class="logo-container" id="sidebar-logo-container">
          <h2
            *ngIf="!isSidebarCollapsed"
            class="sidebar-title"
            id="sidebar-title"
          >
            Gestión de Tutorías
          </h2>
        </div>
        <button
          id="sidebar-toggle-btn"
          class="collapse-btn"
          (click)="toggleSidebar()"
          [attr.aria-label]="
            isSidebarCollapsed ? 'Expandir sidebar' : 'Colapsar sidebar'
          "
        >
          <i
            id="sidebar-toggle-icon"
            class="fas"
            [ngClass]="
              isSidebarCollapsed ? 'fa-chevron-right' : 'fa-chevron-left'
            "
          ></i>
        </button>
      </div>

      <nav class="menu" role="navigation" id="menu-nav">
        <button
          (click)="navigateTo('inicio')"
          [ngClass]="{ active: currentView === 'inicio' }"
          class="menu-item"
          [attr.aria-label]="'Ir a Inicio'"
          [title]="isSidebarCollapsed ? 'Inicio' : ''"
          id="menu-inicio-btn"
        >
          <i class="fas fa-home menu-icon" id="icon-inicio"></i>
          <span class="menu-text" *ngIf="!isSidebarCollapsed" id="text-inicio"
            >Inicio</span
          >
          <div
            class="active-indicator"
            *ngIf="currentView === 'inicio'"
            id="active-indicator-inicio"
          ></div>
        </button>

        <button
          (click)="navigateTo('asignaturas')"
          [ngClass]="{ active: currentView === 'asignaturas' }"
          class="menu-item"
          [attr.aria-label]="'Ir a Asignaturas'"
          [title]="isSidebarCollapsed ? 'Asignaturas' : ''"
          id="menu-asignaturas-btn"
        >
          <i class="fas fa-book menu-icon" id="icon-asignaturas"></i>
          <span
            class="menu-text"
            *ngIf="!isSidebarCollapsed"
            id="text-asignaturas"
            >Asignaturas</span
          >
          <div
            class="active-indicator"
            *ngIf="currentView === 'asignaturas'"
            id="active-indicator-asignaturas"
          ></div>
        </button>

        <button
          (click)="navigateTo('horario')"
          [ngClass]="{ active: currentView === 'horario' }"
          class="menu-item"
          [attr.aria-label]="'Ir a Horario de Clases'"
          [title]="isSidebarCollapsed ? 'Horario' : ''"
          id="menu-horario-btn"
        >
          <i class="fas fa-calendar-alt menu-icon" id="icon-horario"></i>
          <span class="menu-text" *ngIf="!isSidebarCollapsed" id="text-horario"
            >Horario de Clases</span
          >
          <div
            class="active-indicator"
            *ngIf="currentView === 'horario'"
            id="active-indicator-horario"
          ></div>
        </button>

        <button
          (click)="navigateTo('tutorias-solicitud')"
          #Navega
          a
          la
          vista
          de
          solicitud
          [ngClass]="{ active: currentView === 'tutorias-solicitud' }"
          class="menu-item"
          [attr.aria-label]="'Ir a Solicitar Tutoría'"
          [title]="isSidebarCollapsed ? 'Solicitar' : ''"
          id="menu-solicitar-btn"
        >
          <i class="fas fa-plus-circle menu-icon" id="icon-solicitar"></i>
          <span
            class="menu-text"
            *ngIf="!isSidebarCollapsed"
            id="text-solicitar"
            >Solicitar Tutoría</span
          >
          <div
            class="active-indicator"
            *ngIf="currentView === 'tutorias-solicitud'"
          ></div>
        </button>

        <button
          (click)="navigateTo('tutorias-mis-solicitudes')"
          #Navega
          a
          la
          vista
          de
          mis
          solicitudes
          [ngClass]="{ active: currentView === 'tutorias-mis-solicitudes' }"
          class="menu-item"
          [attr.aria-label]="'Ir a Mis Solicitudes'"
          [title]="isSidebarCollapsed ? 'Mis Solicitudes' : ''"
        >
          <i class="fas fa-list-alt menu-icon"></i>
          <span class="menu-text" *ngIf="!isSidebarCollapsed"
            >Mis Solicitudes</span
          >
          <div
            class="active-indicator"
            *ngIf="currentView === 'tutorias-mis-solicitudes'"
          ></div>
        </button>

        <button
          (click)="navigateTo('tutorias-historial')"
          #Navega
          a
          la
          vista
          de
          historial
          de
          tutorías
          [ngClass]="{ active: currentView === 'tutorias-historial' }"
          class="menu-item"
          [attr.aria-label]="'Ir a Historial de Tutorías'"
          [title]="isSidebarCollapsed ? 'Historial' : ''"
        >
          <i class="fas fa-history menu-icon"></i>
          <span class="menu-text" *ngIf="!isSidebarCollapsed"
            >Historial de Tutorías</span
          >
          <div
            class="active-indicator"
            *ngIf="currentView === 'tutorias-historial'"
          ></div>
        </button>
      </nav>

      <div
        class="sidebar-footer"
        *ngIf="!isSidebarCollapsed"
        id="sidebar-footer"
      >
        <div class="user-info" id="sidebar-user-info">
          <i class="fas fa-user-circle" id="sidebar-user-icon"></i>
          <span id="sidebar-user-name">{{ userName }}</span>
        </div>
      </div>
    </div>

    <div class="content" id="content">
      <div
        *ngIf="currentView === 'inicio'"
        id="view-inicio"
        class="dashboard-summary"
      >
        <h3 id="welcome-message">Bienvenido, {{ userName }}!</h3>
        <p id="inicio-description">
          Este es tu panel de control como estudiante. Aquí puedes ver un
          resumen de tu actividad.
        </p>

        <div class="summary-cards">
          <div class="card">
            <h4>Solicitudes Pendientes</h4>
            <p class="card-value">{{ pendingTutoringRequests.length }}</p>
            <button
              class="btn-primary"
              (click)="navigateTo('tutorias-mis-solicitudes')"
            >
              Ver Solicitudes
            </button>
          </div>

          <div class="card">
            <h4>Próximas Tutorías Agendadas</h4>
            <div *ngIf="upcomingTutorings.length > 0; else noUpcomingTutorings">
              <ul class="upcoming-tutorias-list">
                <li *ngFor="let tut of upcomingTutorings">
                  {{ tut.subject?.name || "Asignatura" }} con
                  {{ tut.teacher?.user?.name || "Docente" }} el
                  {{ tut.startDate | date : "mediumDate" }} de
                  {{ tut.startDate | date : "shortTime" }} a
                  {{ tut.endDate | date : "shortTime" }}
                </li>
              </ul>
              <button
                class="btn-secondary"
                (click)="navigateTo('tutorias-historial')"
              >
                Ver Todas
              </button>
            </div>
            <ng-template #noUpcomingTutorings>
              <p>No tienes tutorías próximas.</p>
            </ng-template>
          </div>

          <div class="card">
            <h4>Mis Asignaturas</h4>
            <div *ngIf="subjectsEnrolled.length > 0; else noSubjectsEnrolled">
              <ul class="subjects-enrolled-list">
                <li *ngFor="let subj of subjectsEnrolled">
                  {{ subj.name }} ({{ subj.code }})
                </li>
              </ul>
              <button class="btn-secondary" (click)="navigateTo('asignaturas')">
                Ver Asignaturas
              </button>
            </div>
            <ng-template #noSubjectsEnrolled>
              <p>No estás inscrito en asignaturas.</p>
            </ng-template>
          </div>
        </div>
      </div>

      <div *ngIf="currentView === 'asignaturas'">
        <app-list-subject></app-list-subject>
      </div>

      <div *ngIf="currentView === 'horario'">
        <app-student-class-schedule></app-student-class-schedule>
      </div>

      <div *ngIf="currentView === 'tutorias-solicitud'">
        <app-request-tutoring></app-request-tutoring>
      </div>

    <div class="content" id="content">
      <div *ngIf="currentView === 'tutorias-mis-solicitudes'">
        <app-list-tutoring [listType]="'requests'" [forRole]="'student'"></app-list-tutoring>
      </div>

      <div *ngIf="currentView === 'tutorias-historial'">
        <app-list-tutoring [listType]="'tutorings'" [forRole]="'student'" [selectedStatus]="'COMPLETED'"></app-list-tutoring>
      </div>
      </div>
    </div>
  </div>
</div>
